
# Auth Service

–ü—Ä–æ—Å—Ç–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π gRPC –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email —á–µ—Ä–µ–∑ RabbitMQ.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** —Å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–æ–ª–µ–π
- **–û—Ç–ø—Ä–∞–≤–∫–∞ email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** —á–µ—Ä–µ–∑ RabbitMQ
- **gRPC API** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- **–ú–µ—Ç—Ä–∏–∫–∏ Prometheus** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **–ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** —Å –ø–æ–º–æ—â—å—é golang-migrate


## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
auth-service/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ proto/
‚îÇ       ‚îî‚îÄ‚îÄ api.proto              # gRPC –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.go
‚îÇ   ‚îú‚îÄ‚îÄ domain/                    # –î–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.go           # –°—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ value_objects/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_vo.go        # Value Objects
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositories/         # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ rabbit_repository.go
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ user_repository.go
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_service.go
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/           # –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_handler.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ implementations/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ postgres/         # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è PostgreSQL
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ user_repository.go
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ broker/           # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è RabbitMQ
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ rabbit_repository.go
‚îÇ   ‚îú‚îÄ‚îÄ middleware/               # gRPC middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metrics.go
‚îÇ   ‚îú‚îÄ‚îÄ monitoring/               # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metrics.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.go
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ hashing/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ password.go       # –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
‚îÇ       ‚îú‚îÄ‚îÄ service_errors/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ errors.go         # –ë–∏–∑–Ω–µ—Å-–æ—à–∏–±–∫–∏
‚îÇ       ‚îî‚îÄ‚îÄ strings.go            # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ migrations/                   # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ 0001_init_migrations.up.sql
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ server/
‚îÇ       ‚îî‚îÄ‚îÄ main.go               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env.example                  # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ prometheus.yml               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
‚îî‚îÄ‚îÄ go.mod
```

## üìä –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) NOT NULL UNIQUE,
    password BYTEA NOT NULL,
    is_active BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **gRPC** - –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π RPC —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **RabbitMQ** - –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **Squirrel** - SQL builder –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- **validator-playground** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **bcrypt** - —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **Prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **golang-migrate** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –ë–î

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
git clone <repository-url>
cd auth-service
cp .env.example .env
```

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è gRPC –∫–æ–¥–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å proto)

```bash
protoc --go_out=. --go-grpc_out=. api/proto/api.proto
```

### 3. –ó–∞–ø—É—Å–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# PostgreSQL
docker run -d -p 5432:5432 -e POSTGRES_PASSWORD=password postgres:15

# RabbitMQ
docker run -d -p 5672:5672 -p 15672:15672 rabbitmq:3-management

# Prometheus
docker run -d -p 9090:9090 prom/prometheus:latest
```

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
go run cmd/server/main.go
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```env
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=your-password
DB_NAME=your-db

RABBIT_HOST=localhost
RABBIT_PORT=5672
RABBIT_LOGIN=guest
RABBIT_PASSWORD=guest

ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=10
SECRET_KEY=your-secret-key
ALGORITHM=yur-algorithm

METRICS_PORT=2112
```

## üì° API

### gRPC –º–µ—Ç–æ–¥—ã

```proto
service AuthService {
  rpc Register(AuthRequest) returns (RegisterResponse);
  rpc Login(AuthRequest) returns (AuthResponse);
  rpc RefreshTokens(RefreshToken) returns (AuthResponse);
}
```

### –ú–µ—Ç—Ä–∏–∫–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:2112/metrics
```

## üîÑ –ü–æ—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

1. **–ó–∞–ø—Ä–æ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** —á–µ—Ä–µ–∑ gRPC
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏** email –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
3. **–•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è** —Å –ø–æ–º–æ—â—å—é bcrypt
4. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –≤ PostgreSQL
5. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è** –≤ RabbitMQ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email
6. **–í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞** –∫–ª–∏–µ–Ω—Ç—É

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Prometheus:

- `grpc_requests_total` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ gRPC –∑–∞–ø—Ä–æ—Å–æ–≤
- `grpc_request_duration_milliseconds` - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- `grpc_requests_in_flight` - —Ç–µ–∫—É—â–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–∞—Ä–æ–ª–∏ —Ö—ç—à–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é bcrypt
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–µ–∑ —É—Ç–µ—á–∫–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
go run cmd/server/main.go
```

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–æ—Å—Ç–∞–≤–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π
–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
